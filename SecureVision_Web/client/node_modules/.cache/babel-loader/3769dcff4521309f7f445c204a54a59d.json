{"ast":null,"code":"var _jsxFileName = \"/Users/aleclawlor/SecureVision/client/src/components/cameraFeed/mainFeed.js\";\nimport React, { Component } from 'react';\nimport ReactPlayer from 'react-player';\nimport Paper from '@material-ui/core/Paper';\nimport { Button } from '@material-ui/core';\n\nconst cocoSsd = require('@tensorflow-models/coco-ssd');\n\nconst videoSrc = require('./plateTest.mp4');\n\nconst Axios = require('axios');\n\nclass MainFeed extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      source: this.props.source,\n      name: this.props.name,\n      port: this.props.port,\n      buttonNames: this.props.buttonNames,\n      videoRef: React.createRef(),\n      canvasRef: React.createRef(),\n      finished: false\n    };\n\n    this.showDetections = (predictions, video) => {\n      if (this.finished) {\n        return;\n      } // const ctx = this.state.canvasRef.current.getContext(\"2d\");\n\n\n      let vid = this.state.videoRef.current;\n\n      vid.onended = () => {\n        this.finished = true;\n        alert(\"video has ended\");\n      }; // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      // const font = \"24px helvetica\";\n      // ctx.font = font;\n      // ctx.textBaseline = \"top\";\n\n\n      predictions.forEach(prediction => {\n        console.log(prediction);\n\n        if (prediction.class === 'car' || prediction.class === 'motorcycle' || prediction.class === 'truck' || prediction.class === 'bus') {\n          const x = prediction.bbox[0];\n          const y = prediction.bbox[1];\n          const width = prediction.bbox[2];\n          const height = prediction.bbox[3]; //   // Draw the bounding box.\n          //   ctx.strokeStyle = \"#FF7801\";\n          //   ctx.lineWidth = 1;\n          //   ctx.strokeRect(x, y, width, height);\n          //   // Draw the label background.\n          //   ctx.fillStyle = \"#FF7801\";\n          //   const textWidth = ctx.measureText(prediction.class).width;\n          //   const textHeight = parseInt(font, 10);\n          //   // draw top left rectangle\n          //   ctx.fillRect(x, y, textWidth + 10, textHeight + 10);\n          //   // draw bottom left rectangle\n          //   ctx.fillRect(x, y + height - textHeight, textWidth + 15, textHeight + 10);\n          //   ctx.fillStyle = \"#000000\";\n          //   ctx.fillText(prediction.class, x, y);\n          //   ctx.fillText(prediction.score.toFixed(2), x, y + height - textHeight);\n\n          let tempCanvas = document.createElement('canvas');\n          let tempContext = tempCanvas.getContext('2d');\n          tempContext.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);\n          let imageData = tempContext.getImageData(x, y, width, height); //   // let contrastData = this.imageContrast(imageData, 120)\n          //   // let grayScaleData = this.imageGrayScale(contrastData, tempCanvas.width, tempCanvas.height)\n          //   // let thresholdData = this.imageThreshold(grayScaleData, 170)  \n          //   tempContext.putImageData(imageData, 0, 0)\n\n          let currentCar = new Image();\n          currentCar.src = tempCanvas.toDataURL('image/png');\n          document.body.append(currentCar); // post the current license plate to the ocr route \n\n          const post = async () => {\n            Axios.post('/api/lpr/getOcrData', {\n              image: currentCar\n            });\n            post();\n          };\n        }\n      });\n    };\n\n    this.detectFromVideoFrame = (model, video) => {\n      model.detect(video).then(predictions => {\n        this.showDetections(predictions, video);\n        requestAnimationFrame(() => {\n          this.detectFromVideoFrame(model, video);\n        });\n      }, error => {\n        console.error(error);\n      });\n    };\n  }\n\n  componentDidMount() {\n    const loadlModelPromise = cocoSsd.load(); // resolve all the Promises\n\n    Promise.all([loadlModelPromise]).then(values => {\n      this.detectFromVideoFrame(values[0], this.state.videoRef.current);\n    }).catch(error => {\n      console.error(error);\n    });\n  }\n\n  render() {\n    let player = {\n      marginTop: '5px'\n    };\n    let buttonGridStyle = {\n      width: '700px',\n      height: '200px',\n      textAlign: 'center'\n    };\n    let buttons = {\n      marginLeft: '15px',\n      width: '670px',\n      height: '180px',\n      display: 'grid',\n      gridTemplateColumns: 'repeat(6, 111.66px)'\n    };\n    const styles = {\n      position: 'fixed',\n      top: 150,\n      left: 150\n    };\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        width: '700px',\n        height: '420px',\n        backgroundColor: '#333'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(\"video\", {\n      src: videoSrc,\n      ref: this.state.videoRef,\n      width: \"100%\",\n      height: \"100%\",\n      controls: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }), React.createElement(\"canvas\", {\n      style: styles,\n      ref: this.state.canvasRef,\n      width: \"720\",\n      height: \"650\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      style: {\n        marginTop: '15px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      style: {\n        marginLeft: '15px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, this.state.name)), React.createElement(\"div\", {\n      style: buttonGridStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: buttons,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }, this.state.buttonNames.map(d => {\n      console.log(d);\n      return React.createElement(Button, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, d);\n    })))));\n  }\n\n}\n\nexport default MainFeed;","map":{"version":3,"sources":["/Users/aleclawlor/SecureVision/client/src/components/cameraFeed/mainFeed.js"],"names":["React","Component","ReactPlayer","Paper","Button","cocoSsd","require","videoSrc","Axios","MainFeed","state","source","props","name","port","buttonNames","videoRef","createRef","canvasRef","finished","showDetections","predictions","video","vid","current","onended","alert","forEach","prediction","console","log","class","x","bbox","y","width","height","tempCanvas","document","createElement","tempContext","getContext","drawImage","imageData","getImageData","currentCar","Image","src","toDataURL","body","append","post","image","detectFromVideoFrame","model","detect","then","requestAnimationFrame","error","componentDidMount","loadlModelPromise","load","Promise","all","values","catch","render","player","marginTop","buttonGridStyle","textAlign","buttons","marginLeft","display","gridTemplateColumns","styles","position","top","left","backgroundColor","map","d"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport ReactPlayer from 'react-player'\nimport Paper from '@material-ui/core/Paper'\nimport { Button } from '@material-ui/core'\nconst cocoSsd = require('@tensorflow-models/coco-ssd')\nconst videoSrc = require('./plateTest.mp4')\n\nconst Axios = require('axios')\n\nclass MainFeed extends Component{\n\nstate = {\n        source: this.props.source,\n        name: this.props.name,\n        port: this.props.port,\n        buttonNames: this.props.buttonNames,\n        videoRef: React.createRef(),\n        canvasRef: React.createRef(),\n        finished: false\n  }  \n  showDetections = (predictions, video) => {\n    if(this.finished){\n        return \n    }\n\n    // const ctx = this.state.canvasRef.current.getContext(\"2d\");\n    \n    let vid = this.state.videoRef.current\n    vid.onended = () => {\n      this.finished = true \n      alert(\"video has ended\")\n    }\n\n    // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // const font = \"24px helvetica\";\n    // ctx.font = font;\n    // ctx.textBaseline = \"top\";\n    predictions.forEach(prediction => {\n\n      console.log(prediction)\n\n      if(prediction.class === 'car' || prediction.class === 'motorcycle' || prediction.class === 'truck' || prediction.class === 'bus'){\n      const x = prediction.bbox[0];\n      const y = prediction.bbox[1];\n      const width = prediction.bbox[2];\n      const height = prediction.bbox[3];\n    //   // Draw the bounding box.\n    //   ctx.strokeStyle = \"#FF7801\";\n    //   ctx.lineWidth = 1;\n    //   ctx.strokeRect(x, y, width, height);\n    //   // Draw the label background.\n    //   ctx.fillStyle = \"#FF7801\";\n    //   const textWidth = ctx.measureText(prediction.class).width;\n    //   const textHeight = parseInt(font, 10);\n    //   // draw top left rectangle\n    //   ctx.fillRect(x, y, textWidth + 10, textHeight + 10);\n    //   // draw bottom left rectangle\n    //   ctx.fillRect(x, y + height - textHeight, textWidth + 15, textHeight + 10);\n\n    //   ctx.fillStyle = \"#000000\";\n    //   ctx.fillText(prediction.class, x, y);\n    //   ctx.fillText(prediction.score.toFixed(2), x, y + height - textHeight);\n\n      let tempCanvas = document.createElement('canvas')\n      let tempContext = tempCanvas.getContext('2d')\n      tempContext.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height)\n      let imageData = tempContext.getImageData(x, y, width, height)\n      \n    //   // let contrastData = this.imageContrast(imageData, 120)\n    //   // let grayScaleData = this.imageGrayScale(contrastData, tempCanvas.width, tempCanvas.height)\n    //   // let thresholdData = this.imageThreshold(grayScaleData, 170)  \n    //   tempContext.putImageData(imageData, 0, 0)\n\n      let currentCar = new Image()\n      currentCar.src = tempCanvas.toDataURL('image/png')\n      document.body.append(currentCar)\n\n      // post the current license plate to the ocr route \n      const post = async() => {\n        Axios.post('/api/lpr/getOcrData', {\n          image: currentCar\n        })\n\n      post()\n    }\n   \n\n      }\n    });\n  };\n\n    detectFromVideoFrame = (model, video) => {\n        model.detect(video).then(predictions => {\n          this.showDetections(predictions, video);\n          requestAnimationFrame(() => {\n            this.detectFromVideoFrame(model, video);\n          });\n        }, (error) => {\n          console.error(error)\n        });\n      };\n\n    componentDidMount(){\n        const loadlModelPromise = cocoSsd.load();\n\n      // resolve all the Promises\n        Promise.all([loadlModelPromise])\n            .then(values => {\n            this.detectFromVideoFrame(values[0], this.state.videoRef.current);\n            })\n            .catch(error => {\n            console.error(error);\n            });\n    }\n\n    render(){\n\n        let player = {\n            marginTop: '5px'\n        }\n\n        let buttonGridStyle={\n            width: '700px',\n            height: '200px',\n            textAlign:'center'\n        }\n\n        let buttons = {\n            marginLeft: '15px', \n            width: '670px', \n            height:'180px', \n            display: 'grid',\n            gridTemplateColumns: 'repeat(6, 111.66px)'\n        }\n\n        const styles = {\n            position: 'fixed',\n            top: 150,\n            left: 150,\n          };\n\n        return(\n            <div>\n                <div style={{width: '700px', height: '420px', backgroundColor: '#333'}}>\n                    {/* <ReactPlayer url={'https://www.youtube.com/watch?v=F4SY7kTpqjk'} playing muted controls={false} className={player} width=\"100%\" height=\"100%\"/> */}\n                    <video src={videoSrc} ref={this.state.videoRef} width=\"100%\" height=\"100%\" controls></video>\n                    <canvas style={styles} ref={this.state.canvasRef} width=\"720\" height=\"650\" />\n                    <div style={{marginTop: '15px'}}>\n                        <h1 style={{marginLeft: '15px'}}>{this.state.name}</h1>\n                    </div>\n                    <div style={buttonGridStyle}>\n                        <div style={buttons}>\n                            {this.state.buttonNames.map((d) => {\n                                console.log(d)\n                             return <Button>{d}</Button>\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default MainFeed"]},"metadata":{},"sourceType":"module"}